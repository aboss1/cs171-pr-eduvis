<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <style>
  .background {
    fill: none;
    pointer-events: all;
  }
  .feature {
    fill: #bbb;
    cursor: pointer;
  }
  .feature.active {
    fill: orange;
  }
  .mesh {
    fill: none;
    stroke: #fff;
    stroke-linecap: round;
    stroke-linejoin: round;
  }
  .districts {
    fill: #bbb;
  }
  .districts :hover {
    fill: orange;
  }
  .district-boundaries {
    pointer-events: none;
    fill: none;
    stroke: #fff;
    stroke-width: .5px;
  }
  .state-boundaries {
    pointer-events: none;
    fill: none;
    stroke: #fff;
    stroke-width: 1.5px;
  }
  .d3-tip {
    opacity: .6;
    line-height: 1;
    font-weight: bold;
    padding: 12px;
    background: gray;
    color: #fff;
    border-radius: 2px;
  }

  /* Creates a small triangle extender for the tooltip */
  .d3-tip:after {
    box-sizing: border-box;
    display: inline;
    font-size: 10px;
    width: 100%;
    line-height: 1;
    color: gray;
    content: "\25BC";
    position: absolute;
    text-align: center;
  }

  /* Style northward tooltips differently */
  .d3-tip.n:after {
    margin: -1px 0 0 0;
    top: 100%;
    left: 0;
  }
  </style>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <div id="results"></div>
  <script>
   d3.json("data.csv",function(error,data){
   // for(j=0;j<data.length;j++){
    console.log(data)
   // }
  })
      /**
       * Build and execute request to look up voter info for provided address.
       * @param {string} address Address for which to fetch voter info.
       * @param {function(Object)} callback Function which takes the
       *     response object as a parameter.
       */
       function lookup(ocdId, callback) {
       /**
         * Election ID for which to fetch voter info.
         * @type {number}
         */
         var electionId = 2000;

        /**
         * Request object for given parameters.
         * @type {gapi.client.HttpRequest}
         */
         var req = gapi.client.request({
          'path' : '/civicinfo/v2/representatives/ocdId',
          'params' : {'ocdId' : ocdId}
        });
         req.execute(callback);
       }
      /**
       * Render results in the DOM.
       * @param {Object} response Response object returned by the API.
       * @param {Object} rawResponse Raw response from the API.
       */
       var currRep = "None";
       var currParty = "None";
       var currImage;

       function renderResults(response, rawResponse) {
        var el = document.getElementById('results');
        if(response.officials!==undefined){

          currRep = response.officials[0].name;
          currParty = response.officials[0].party;
          if(response.officials[0].photoUrl!==undefined){
            currImage = response.officials[0].photoUrl;}
          }

        }
      /**
       * Initialize the API client and make a request.
       */
       function load(ocdID) {
        //if hover, lookup
        gapi.client.setApiKey('AIzaSyBHPREBn2NpMTEVN_6V21E7Ny45VDCuHxo');

        lookup(ocdID, renderResults);
      }
      var width = 960,
      height = 600,
      active = d3.select(null);
      var projection = d3.geo.albersUsa()
      .scale(1280)
      .translate([width / 2, height / 2]);
      var path = d3.geo.path()
      .projection(projection);

      queue()
      .defer(d3.json, "https://gist.githubusercontent.com/mbostock/4090846/raw/c899e3d4f3353924e495667c842f54a07090cfab/us.json")
      .defer(d3.json, "https://gist.githubusercontent.com/mbostock/4090846/raw/450f6be2e8f3bd969fae0cc7d19db6bde5d614ed/us-congress-113.json")
      .defer(d3.tsv, "https://gist.githubusercontent.com/mbostock/4090846/raw/3f0d8f1df485eec60d8cc75f8575e7e55f569904/us-state-names.tsv")
      .await(ready);

      var modifiedData = [];
      function ready(error, us, congress, stateId) {

  //# of districts = 441
  //check id of district geometries
    //if id is equal to stateID
      //assign

      var districts = congress.objects.districts.geometries;
      for (var c = 0; c<districts.length; c++){
        var newModifiedData = {};
        for (var s = 0; s<stateId.length; s++){
          var stateID = districts[c].id.toString();
          var districtID = districts[c].id.toString();
          stateID = stateID.substring(0, stateID.length - 2);
          districtID = districtID.slice(-2);
          if (stateID == stateId[s].id){
            newModifiedData.districtId = parseInt(districtID, 10);
            newModifiedData.stateAbbrev = stateId[s].code.toLowerCase();
            newModifiedData.stateId = stateID;
            newModifiedData.fullId = districts[c].id;
            newModifiedData.stateName = stateId[s].name;
            newModifiedData.ocdID = "ocd-division/country:us/state:" + newModifiedData.stateAbbrev + "/cd:"
            + newModifiedData.districtId;
            modifiedData.push(newModifiedData);
          }
        }
      }

      function searchOcdId(givenID){
        for (var m = 0; m< modifiedData.length; m++){
          if (givenID == modifiedData[m].fullId){
            var rep = load(modifiedData[m].ocdID);
            break;
          }
        }
        return rep;
      }

      var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height);
      svg.append("rect")
      .attr("class", "background")
      .attr("width", width)
      .attr("height", height)
      .on("click", reset);

      var tip = d3.tip()
      .attr('class', 'd3-tip')
      .offset([-10, 0])
      .html(function(d) {
        var rep = searchOcdId(d.id);
        return "<strong>Representative:</strong> <span style='color:black'>" + currRep + "</span><br>"
        + "<strong>Party:</strong> <span style='color:black'>" + currParty + "</span><br>"
        + "<img src = '" + currImage + "'alt = 'No Image' width='100' height='128'/>";
      })

      svg.call(tip);

      var g = svg.append("g")
      .style("stroke-width", "1.5px");
      g.selectAll("path")
      .data(topojson.feature(congress, congress.objects.districts).features)
      .enter().append("path")
      .attr("d", path)
      .attr("class", "feature")
      .on("click", clicked)
      .on("mouseover", tip.show)
      .on("mouseout", tip.hide);
    
    //make the boundaries 
    g.append("path")
    .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
    .attr("class", "mesh")
    .attr("d", path);

    //make a class called district boundaries in order to clearly show the boundaries by using css
    g.append("path")
    .attr("class", "district-boundaries")
    .datum(topojson.mesh(congress, congress.objects.districts, function(a, b) { return a !== b && (a.id / 1000 | 0) === (b.id / 1000 | 0); }))
    .attr("d", path).append("title")
    // .text(function(d) { return d.id; });
    
    //if the district was clicked, zoom in 
    function clicked(d) {
      if (active.node() === this) return reset();
      active.classed("active", false);
      active = d3.select(this).classed("active", true);
      var bounds = path.bounds(d),
      dx = bounds[1][0] - bounds[0][0],
      dy = bounds[1][1] - bounds[0][1],
      x = (bounds[0][0] + bounds[1][0]) / 2,
      y = (bounds[0][1] + bounds[1][1]) / 2,
      scale = .9 / Math.max(dx / width, dy / height),
      translate = [width / 2 - scale * x, height / 2 - scale * y];
      g.transition()
      .duration(750)
      .style("stroke-width", 1.5 / scale + "px")
      .attr("transform", "translate(" + translate + ")scale(" + scale + ")");
    }

    //if the district is clicked again, return to the original state
    function reset() {
      active.classed("active", false);
      active = d3.select(null);
      g.transition()
      .duration(750)
      .style("stroke-width", "1.5px")
      .attr("transform", "");
    }
  }

  </script>
  <script src="https://apis.google.com/js/client.js?onload=load"></script>
</head>
<body>

 <form> <b>Time</b>: 